<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>RepMax Calculator</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script type="module">
        import RepCalculator from "./dist/rep-calc.js";

        const weightInput = document.querySelector('#weight')
        const repsInput = document.querySelector('#reps')
        const rpeInput = document.querySelector('#rpe')
        const roundInput = document.querySelector('#round')

        function roundFloat(value, toNearest, fixed) {
            return (Math.ceil(value / toNearest) * toNearest).toFixed(fixed)
        }

        function calculateRepMax() {
            const resultEl = document.querySelector('#result')
            resultEl.innerHTML = ''

            const resultDetailsEl = document.querySelector('#resultDetails')
            resultDetailsEl.innerHTML = ''

            const weight = document.querySelector('#weight').value
            const reps = document.querySelector('#reps').value
            const round = document.querySelector('#round').value

            if (!weight || !reps) {
                return
            }

            const calc = new RepCalculator()

            const average = calc.getOneRepMaxAverage(parseFloat(weight), parseFloat(reps))
            const min = calc.getOneRepMaxLow(parseFloat(weight), parseFloat(reps))
            const max = calc.getOneRepMaxHigh(parseFloat(weight), parseFloat(reps))

            resultEl.innerHTML = roundFloat(average, round, 2)

            resultDetailsEl.innerHTML = 'Lowest estimate: ' + min.toFixed(2) + '<br>' +
                'Highest estimate: ' + max.toFixed(2)

            for (const rep of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]) {
                const calc = new Brzycki()
                const r = calc.calcReps(parseFloat(weight), parseFloat(reps), rep)

                resultDetailsEl.innerHTML += '<br> At reps ' + rep + ': ~' + r.toFixed(2)
            }
        }

        weightInput.addEventListener('keyup', calculateRepMax)
        repsInput.addEventListener('keyup', calculateRepMax)
        roundInput.addEventListener('change', calculateRepMax)

    </script>
</head>

<body class="container container-sm">
<div class="row justify-content-center">
    <div class="col-6">
        <h4 class="display-6 text-center py-3">One Rep Max Calculator</h4>

        <form>
            <div class="row py-1">
                <div class="col">
                    <label for="weight" class="col-form-label fw-bold">Weight:</label>
                    <input type="number" name="weight" id="weight" class="form-control form-control-lg">
                </div>

                <div class="col">
                    <label for="reps" class="col-form-label fw-bold">Reps:</label>
                    <input type="number" name="reps" id="reps" class="form-control form-control-lg">
                </div>
            </div>

            <div class="row small">
                <div class="col-12 text-center">
                    <label for="rpe" class="col-form-label fw-bold">@ RPE:</label>

                    <select id="rpe" name="rpe" class="form-control form-control-sm d-inline-block w-auto">
                        <option value="10">Extreme</option>
                        <option value="9" selected="selected">Very hard</option>
                        <option value="8">Hard</option>
                        <option value="7">Moderate</option>
                    </select>

                    <label for="round" class="col-form-label fw-bold">Rounded to nearest:</label>
                    <select id="round" name="round" class="form-control form-control-sm d-inline-block w-auto">
                        <option value="5">5</option>
                        <option value="2.5" selected="selected">2.5</option>
                        <option value="1">1</option>
                        <option value="0.01">No rounding</option>
                    </select>
                </div>
            </div>
        </form>

        <div class="text-center py-5">
            <div>Calculated One Rep Max</div>
            <div class="display-6 fw-bold" id="result"></div>
            <div id="resultDetails"></div>
        </div>
    </div>
</div>
</body>

</html>
